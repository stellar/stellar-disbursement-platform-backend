FROM stellar/anchor-platform:2.6.0

# Update package list and install the latest OpenJDK 17
# Ubuntu 22.04 should have OpenJDK 17.0.16+ available
RUN apt-get update && \
    apt-get install -y openjdk-17-jdk ca-certificates-java && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/* && \
    update-ca-certificates -f

# Set JAVA_HOME to use OpenJDK 17 (architecture-agnostic)
ENV JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64
ENV PATH=$JAVA_HOME/bin:$PATH

# For multi-arch support, create symlink if needed
RUN if [ ! -d "$JAVA_HOME" ] && [ -d "/usr/lib/jvm/java-17-openjdk-arm64" ]; then \
      ln -s /usr/lib/jvm/java-17-openjdk-arm64 $JAVA_HOME; \
    fi

# Verify the JDK version meets requirements
RUN java -version && echo "JDK installation complete"